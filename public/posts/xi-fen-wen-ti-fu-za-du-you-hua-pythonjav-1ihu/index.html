<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="shortcut icon" href="http://example.org/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.min.css">

    <link rel="canonical" href="http://example.org/posts/xi-fen-wen-ti-fu-za-du-you-hua-pythonjav-1ihu/" />
    <title>细分问题 &#43; 复杂度优化（Python/Java/C&#43;&#43;/Go）</title>
</head>
<body><header id="banner">
    <h2><a href="http://example.org/">My New Hugo Site</a></h2>
    <nav>
        <ul>
            
        </ul>
    </nav>
</header>
<main id="content">
<article>
    <header id="post-header">
        <h1>细分问题 &#43; 复杂度优化（Python/Java/C&#43;&#43;/Go）</h1>
        <div>
                <time>October 14, 2022</time>
            </div>
    </header><blockquote>
<p><a href="https://leetcode.cn/problems/distinct-subsequences-ii">原题 940.不同的子序列 II</a></p>
</blockquote>
<h4 id="提示-1">提示 1</h4>
<p>对于子序列问题，通常可以从每个元素「选或不选」的角度入手。</p>
<h4 id="提示-2">提示 2</h4>
<p>麻烦的地方在于，如何保证对同样的子序列，我们只统计一次？</p>
<p>比如示例 2，从左往右遍历 $\text{<code>aba'}$，对于前两个字符 $\text{</code>ab&rsquo;}$ 可以得到 $\text{<code>a'},\text{</code>b&rsquo;},\text{<code>ab'}$ 这三个不同的子序列，但是遍历到第三个字符 $\text{</code>a&rsquo;}$ 时，如果选 $\text{<code>a'}$ 单独作为子序列，会和前面得到的 $\text{</code>a&rsquo;}$ 重复。</p>
<p>你可能会想，如果我把这个 $\text{<code>a'}$ **加到 $\text{</code>a&rsquo;},\text{<code>b'},\text{</code>ab&rsquo;}$ 的末尾**呢？这样可以得到不同的子序列 $\text{<code>aa'},\text{</code>ba&rsquo;},\text{<code>aba'}$，同时把 $\text{</code>a&rsquo;}$ 单独作为一个子序列，也不会和这些子序列重复。</p>
<p>这个想法不错，但是这种做法没有把 $\text{<code>b'},\text{</code>ab&rsquo;}$ 计入（即不选 $\text{<code>a'}$ 的情况）。不过注意到这两个都不是以 $\text{</code>a&rsquo;}$ 结尾的，那如果把原问题细分一下，改为<strong>分别统计以 $\text{<code>a'},\text{</code>b&rsquo;},\cdots,\text{`z&rsquo;}$ 结尾的不同子序列的个数</strong>，问题就迎刃而解了。</p>
<p>具体来说，在遍历 $s$ 的过程中，把 $s[i]$ 加到<strong>前 $i-1$ 个字符</strong>组成的不同子序列的末尾，同时把 $s[i]$ 单独作为一个子序列，即得到了<strong>前 $i$ 个字符</strong>以 $s[i]$ 结尾的不同子序列的个数。遍历结束后把以 $\text{<code>a'},\text{</code>b&rsquo;},\cdots,\text{`z&rsquo;}$ 结尾的不同子序列的个数相加，就得到了答案。</p>
<p>你也可以这样理解：这种做法对于相同的子序列，只会考虑其最后一次出现的位置（下标序列的字典序最大）。</p>
<h4 id="提示-3">提示 3</h4>
<p>怎么实现？</p>
<p>上述思路是一个标准的关于<strong>递推</strong>的描述，我们定义 $f[i][j]$ 表示用 $s$ 的前 $i$ 个字符组成以 $j$ 结尾的不同非空子序列的个数，根据上述思路，得</p>
<p>$$
f[i][s[i]] = 1 + \sum_{j=\text{<code>a'}}^{\text{</code>z&rsquo;}} f[i-1][j]
$$</p>
<p>这里的 $1$ 指的是单独把 $s[i]$ 作为一个子序列。</p>
<p>初始值 $f[0][s[0]] = 1$，答案为 $\sum\limits_{j=\text{<code>a'}}^{\text{</code>z&rsquo;}} f[n-1][j]$。</p>
<p>为方便计算，代码实现时把字母 $\text{<code>a'}$ 到 $\text{</code>z&rsquo;}$ 用 $0$ 到 $25$ 表示。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>MOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">distinctSubseqII</span>(self, s: str) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>        f <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">26</span> <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(len(s) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, c <span style="color:#f92672">in</span> enumerate(s, <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">=</span> ord(c) <span style="color:#f92672">-</span> ord(<span style="color:#e6db74">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span>            f[i] <span style="color:#f92672">=</span> f[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>copy()
</span></span><span style="display:flex;"><span>            f[i][c] <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> sum(f[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>])) <span style="color:#f92672">%</span> MOD
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> sum(f[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#f92672">%</span> MOD
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> MOD <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">long</span><span style="color:#f92672">)</span> 1e9 <span style="color:#f92672">+</span> 7<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">distinctSubseqII</span><span style="color:#f92672">(</span>String s<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        var n <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        var f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">long</span><span style="color:#f92672">[</span>n<span style="color:#f92672">][</span>26<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">[</span>0<span style="color:#f92672">][</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span> <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var i <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            f<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> f<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">].</span><span style="color:#a6e22e">clone</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>            f<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>1 <span style="color:#f92672">+</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">(</span>f<span style="color:#f92672">[</span>i <span style="color:#f92672">-</span> 1<span style="color:#f92672">]).</span><span style="color:#a6e22e">sum</span><span style="color:#f92672">())</span> <span style="color:#f92672">%</span> MOD<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">(</span>f<span style="color:#f92672">[</span>n <span style="color:#f92672">-</span> 1<span style="color:#f92672">]).</span><span style="color:#a6e22e">sum</span><span style="color:#f92672">()</span> <span style="color:#f92672">%</span> MOD<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> MOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> distinctSubseqII(string s) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> s.length();
</span></span><span style="display:flex;"><span>        vector<span style="color:#f92672">&lt;</span>array<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">26</span><span style="color:#f92672">&gt;&gt;</span> f(n);
</span></span><span style="display:flex;"><span>        f[<span style="color:#ae81ff">0</span>][s[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>i) {
</span></span><span style="display:flex;"><span>            f[i] <span style="color:#f92672">=</span> f[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>            f[i][s[i] <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>] <span style="color:#f92672">=</span> accumulate(f[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].begin(), f[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].end(), <span style="color:#ae81ff">1L</span>) <span style="color:#f92672">%</span> MOD;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">accumulate</span>(f[n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].begin(), f[n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>].end(), <span style="color:#ae81ff">0L</span>) <span style="color:#f92672">%</span> MOD;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">distinctSubseqII</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mod</span> <span style="color:#66d9ef">int64</span> = <span style="color:#ae81ff">1e9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">s</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> make([][<span style="color:#ae81ff">26</span>]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f</span>[<span style="color:#ae81ff">0</span>][<span style="color:#a6e22e">s</span>[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span><span style="color:#e6db74">&#39;a&#39;</span>] = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">n</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">total</span> <span style="color:#f92672">:=</span> int64(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">i</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> int64(<span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">i</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">s</span>[<span style="color:#a6e22e">i</span>]<span style="color:#f92672">-</span><span style="color:#e6db74">&#39;a&#39;</span>] = <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> int(<span style="color:#a6e22e">total</span><span style="color:#f92672">%</span><span style="color:#a6e22e">mod</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">total</span> <span style="color:#f92672">:=</span> int64(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">n</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> int64(<span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> int(<span style="color:#a6e22e">total</span> <span style="color:#f92672">%</span> <span style="color:#a6e22e">mod</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>由于状态转移只发生在 $i$ 和 $i-1$ 之间，因此可以只用一个长为 $26$ 的数组表示上述状态转移过程。由于除了 $f[s[i]]$ 以外，其余值都不变，因此只需要更新 $f[s[i]]$ 的值。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>MOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">distinctSubseqII</span>(self, s: str) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>        f <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">26</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> s:
</span></span><span style="display:flex;"><span>            f[ord(c) <span style="color:#f92672">-</span> ord(<span style="color:#e6db74">&#39;a&#39;</span>)] <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> sum(f)) <span style="color:#f92672">%</span> MOD
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> sum(f) <span style="color:#f92672">%</span> MOD
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> MOD <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">long</span><span style="color:#f92672">)</span> 1e9 <span style="color:#f92672">+</span> 7<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">distinctSubseqII</span><span style="color:#f92672">(</span>String s<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        var f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">long</span><span style="color:#f92672">[</span>26<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        var n <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span>
</span></span><span style="display:flex;"><span>            f<span style="color:#f92672">[</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>1 <span style="color:#f92672">+</span> Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">(</span>f<span style="color:#f92672">).</span><span style="color:#a6e22e">sum</span><span style="color:#f92672">())</span> <span style="color:#f92672">%</span> MOD<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>Arrays<span style="color:#f92672">.</span><span style="color:#a6e22e">stream</span><span style="color:#f92672">(</span>f<span style="color:#f92672">).</span><span style="color:#a6e22e">sum</span><span style="color:#f92672">()</span> <span style="color:#f92672">%</span> MOD<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> MOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> distinctSubseqII(string s) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> f[<span style="color:#ae81ff">26</span>]{};
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">char</span> c : s)
</span></span><span style="display:flex;"><span>            f[c <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span>] <span style="color:#f92672">=</span> accumulate(f, f <span style="color:#f92672">+</span> <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">1L</span>) <span style="color:#f92672">%</span> MOD;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">accumulate</span>(f, f <span style="color:#f92672">+</span> <span style="color:#ae81ff">26</span>, <span style="color:#ae81ff">0L</span>) <span style="color:#f92672">%</span> MOD;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">distinctSubseqII</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mod</span> <span style="color:#66d9ef">int64</span> = <span style="color:#ae81ff">1e9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> [<span style="color:#ae81ff">26</span>]<span style="color:#66d9ef">int</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">s</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">total</span> <span style="color:#f92672">:=</span> int64(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">f</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> int64(<span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">c</span><span style="color:#f92672">-</span><span style="color:#e6db74">&#39;a&#39;</span>] = <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> int(<span style="color:#a6e22e">total</span><span style="color:#f92672">%</span><span style="color:#a6e22e">mod</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">total</span> <span style="color:#f92672">:=</span> int64(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">f</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">total</span> <span style="color:#f92672">+=</span> int64(<span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> int(<span style="color:#a6e22e">total</span> <span style="color:#f92672">%</span> <span style="color:#a6e22e">mod</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>由于在 $\textit{total}=\sum\limits_{j=0}^{25} f[j]$ 中，每次只有 $f[s[i]]$ 在变动，因此我们可以直接更新 $f[s[i]]$ 和 $\textit{total}$，不需要每次都重新算一遍 $\textit{total}$。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>MOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">distinctSubseqII</span>(self, s: str) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>        total <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        f <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">26</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> s:
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">=</span> ord(c) <span style="color:#f92672">-</span> ord(<span style="color:#e6db74">&#39;a&#39;</span>)
</span></span><span style="display:flex;"><span>            others <span style="color:#f92672">=</span> total <span style="color:#f92672">-</span> f[c]  <span style="color:#75715e"># total 中不含 f[c] 的部分</span>
</span></span><span style="display:flex;"><span>            f[c] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> total  <span style="color:#75715e"># 更新 f[c]</span>
</span></span><span style="display:flex;"><span>            total <span style="color:#f92672">=</span> (f[c] <span style="color:#f92672">+</span> others) <span style="color:#f92672">%</span> MOD  <span style="color:#75715e"># 更新 total</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> total
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> MOD <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> 1e9 <span style="color:#f92672">+</span> 7<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">distinctSubseqII</span><span style="color:#f92672">(</span>String s<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        var total <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        var f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>26<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        var n <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> <span style="color:#f92672">++</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            var c <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">-</span> <span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>            var others <span style="color:#f92672">=</span> total <span style="color:#f92672">-</span> f<span style="color:#f92672">[</span>c<span style="color:#f92672">];</span> <span style="color:#75715e">// total 中不含 f[c] 的部分（由于取模的原因，这里的减法可能会产生负数）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            f<span style="color:#f92672">[</span>c<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> 1 <span style="color:#f92672">+</span> total<span style="color:#f92672">;</span> <span style="color:#75715e">// 更新 f[c]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            total <span style="color:#f92672">=</span> <span style="color:#f92672">((</span>f<span style="color:#f92672">[</span>c<span style="color:#f92672">]</span> <span style="color:#f92672">+</span> others<span style="color:#f92672">)</span> <span style="color:#f92672">%</span> MOD <span style="color:#f92672">+</span> MOD<span style="color:#f92672">)</span> <span style="color:#f92672">%</span> MOD<span style="color:#f92672">;</span> <span style="color:#75715e">// 更新 total，并保证 total 非负
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> total<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> MOD <span style="color:#f92672">=</span> <span style="color:#ae81ff">1e9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> distinctSubseqII(string s) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> total <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, f[<span style="color:#ae81ff">26</span>]{};
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">char</span> c : s) {
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">-=</span> <span style="color:#e6db74">&#39;a&#39;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> others <span style="color:#f92672">=</span> total <span style="color:#f92672">-</span> f[c]; <span style="color:#75715e">// total 中不含 f[c] 的部分（由于取模的原因，这里的减法可能会产生负数）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            f[c] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> total; <span style="color:#75715e">// 更新 f[c]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            total <span style="color:#f92672">=</span> ((f[c] <span style="color:#f92672">+</span> others) <span style="color:#f92672">%</span> MOD <span style="color:#f92672">+</span> MOD) <span style="color:#f92672">%</span> MOD; <span style="color:#75715e">// 更新 total，并保证 total 非负
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> total;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">distinctSubseqII</span>(<span style="color:#a6e22e">s</span> <span style="color:#66d9ef">string</span>) (<span style="color:#a6e22e">total</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">mod</span> <span style="color:#66d9ef">int</span> = <span style="color:#ae81ff">1e9</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> [<span style="color:#ae81ff">26</span>]<span style="color:#66d9ef">int</span>{}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">s</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">c</span> <span style="color:#f92672">-=</span> <span style="color:#e6db74">&#39;a&#39;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">others</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">total</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">c</span>] <span style="color:#75715e">// total 中不含 f[c] 的部分（由于取模的原因，这里的减法可能会产生负数）
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">c</span>] = <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">total</span> <span style="color:#75715e">// 更新 f[c]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">total</span> = ((<span style="color:#a6e22e">f</span>[<span style="color:#a6e22e">c</span>]<span style="color:#f92672">+</span><span style="color:#a6e22e">others</span>)<span style="color:#f92672">%</span><span style="color:#a6e22e">mod</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">mod</span>) <span style="color:#f92672">%</span> <span style="color:#a6e22e">mod</span> <span style="color:#75715e">// 更新 total，并保证 total 非负
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="复杂度分析">复杂度分析</h4>
<ul>
<li>时间复杂度：$O(n+|\Sigma|)$，其中 $n$ 为 $s$ 的长度。</li>
<li>空间复杂度：$O(|\Sigma|)$，其中 $|\Sigma|$ 为字符集合的大小，本题中字符均为小写字母，所以 $|\Sigma|=26$。</li>
</ul>
<hr>
<p>欢迎关注我的B站频道：<a href="https://space.bilibili.com/206214">灵茶山艾府</a>，定期更新算法讲解视频哦~</p>
</article>

        </main><footer id="footer">
    
</footer>
</body>
</html>
