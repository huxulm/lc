<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="shortcut icon" href="http://example.org/favicon.ico">
    
    <link rel="stylesheet" href="/css/style.min.css">

    <link rel="canonical" href="http://example.org/page/jiantu-by-endlesscheng-rkra/" />
    <title>建图技巧 &#43; 并查集（Python/Java/C&#43;&#43;/Go）</title>
</head>
<body><header id="banner">
    <h2><a href="http://example.org/">My New Hugo Site</a></h2>
    <nav>
        <ul>
            
        </ul>
    </nav>
</header>
<main id="content">
<article>
    <header id="post-header">
        <h1>建图技巧 &#43; 并查集（Python/Java/C&#43;&#43;/Go）</h1>
        <div>
                <time>October 8, 2022</time>
            </div>
    </header><blockquote>
<p><a href="https://leetcode.cn/problems/kskhHQ">原题 LCP 71.集水器</a>
<a href="https://www.bilibili.com/video/BV1rT411P7NA">视频讲解</a> 已出炉，欢迎点赞三连，在评论区分享你对这场力扣杯的看法~</p>
</blockquote>
<p>记录关键思路，详细的说明见视频讲解。</p>
<ol>
<li>判断能否容纳水：第 $i$ 行的水，在不走到第 $i-1$ 行的前提下，无法触及左、右、下边界。</li>
<li>转换成连通性问题，用并查集处理。</li>
<li>为了方便判断是否触及边界，还需要在左、右、下各加一条格子。</li>
<li>根据 1，我们可以从最后一行往上计算。</li>
<li>用并查集合并当前行各个区域，以及边界。</li>
<li>如果合并完了，枚举当前行的各个区域，如果不和边界相连，那么该区域能容纳水。</li>
<li>边界、最上面一层和超级汇点 $0$ 相连。</li>
<li>最后判断的时候，如果该区域能容纳水，且和超级汇点相连，那么不是闭合区域，就真的有水。</li>
<li>统计真的有水的格子，即为答案。</li>
<li>代码实现时，把每个格子划分四个区域，相对两个区域，代码写起来要容易一些。</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reservoir</span>(self, shape: List[str]) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>        n, m <span style="color:#f92672">=</span> len(shape), len(shape[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 每个格子分成四个区域（上下左右），标上序号，方便用并查集连通</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 假设左右下还有一圈格子，直接连到超级汇点 0</span>
</span></span><span style="display:flex;"><span>        u <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> (m <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> (m <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>        l <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> (m <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> (m <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span>        c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):  <span style="color:#75715e"># 假设格子的列号从 1 开始，这样方便表示左右边界</span>
</span></span><span style="display:flex;"><span>                u[i][j] <span style="color:#f92672">=</span> c; c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                d[i][j] <span style="color:#f92672">=</span> c; c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                l[i][j] <span style="color:#f92672">=</span> c; c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                r[i][j] <span style="color:#f92672">=</span> c; c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 并查集模板</span>
</span></span><span style="display:flex;"><span>        fa <span style="color:#f92672">=</span> list(range(c))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">find</span>(x: int) <span style="color:#f92672">-&gt;</span> int:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> fa[x] <span style="color:#f92672">!=</span> x:
</span></span><span style="display:flex;"><span>                fa[x] <span style="color:#f92672">=</span> find(fa[x])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> fa[x]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">merge</span>(x: int, y: int):
</span></span><span style="display:flex;"><span>            fa[find(x)] <span style="color:#f92672">=</span> find(y)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ok <span style="color:#f92672">=</span> [<span style="color:#66d9ef">False</span>] <span style="color:#f92672">*</span> c  <span style="color:#75715e"># 能否容纳水</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 倒着判断每一行，寻找可能有水的区域</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>                merge(r[i][j], l[i][j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>])  <span style="color:#75715e"># 连通左右</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j, type <span style="color:#f92672">in</span> enumerate(shape[i], <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>                merge(d[i][j], u[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][j])  <span style="color:#75715e"># 连通下</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 根据格子的类型连接格子内部四个区域</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.&#39;</span>:
</span></span><span style="display:flex;"><span>                    merge(l[i][j], u[i][j])
</span></span><span style="display:flex;"><span>                    merge(l[i][j], d[i][j])
</span></span><span style="display:flex;"><span>                    merge(l[i][j], r[i][j])
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">elif</span> type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;l&#39;</span>:
</span></span><span style="display:flex;"><span>                    merge(l[i][j], d[i][j])
</span></span><span style="display:flex;"><span>                    merge(r[i][j], u[i][j])
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    merge(l[i][j], u[i][j])
</span></span><span style="display:flex;"><span>                    merge(r[i][j], d[i][j])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># 在没有连接第 i-1 行的情况下，无法到达左右下边界 =&gt; 能容纳水</span>
</span></span><span style="display:flex;"><span>                ok[l[i][j]] <span style="color:#f92672">=</span> find(l[i][j]) <span style="color:#f92672">!=</span> find(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                ok[r[i][j]] <span style="color:#f92672">=</span> find(r[i][j]) <span style="color:#f92672">!=</span> find(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                ok[u[i][j]] <span style="color:#f92672">=</span> find(u[i][j]) <span style="color:#f92672">!=</span> find(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                ok[d[i][j]] <span style="color:#f92672">=</span> find(d[i][j]) <span style="color:#f92672">!=</span> find(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 第一行连上超级汇点，方便后面统一判断是否在闭合区域里面</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            merge(u[<span style="color:#ae81ff">0</span>][j], <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, b <span style="color:#f92672">in</span> enumerate(ok):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> b <span style="color:#f92672">and</span> find(i) <span style="color:#f92672">==</span> find(<span style="color:#ae81ff">0</span>):  <span style="color:#75715e"># 能容纳水，且不在闭合区域里面</span>
</span></span><span style="display:flex;"><span>                ans <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ans <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[]</span> fa<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">reservoir</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[]</span> shape<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> shape<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">,</span> m <span style="color:#f92672">=</span> shape<span style="color:#f92672">[</span>0<span style="color:#f92672">].</span><span style="color:#a6e22e">length</span><span style="color:#f92672">(),</span> c <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 每个格子分成四个区域（上下左右），标上序号，方便用并查集连通
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 假设左右下还有一圈格子，直接连到超级汇点 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span><span style="color:#f92672">[][]</span> u <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n <span style="color:#f92672">+</span> 1<span style="color:#f92672">][</span>m <span style="color:#f92672">+</span> 2<span style="color:#f92672">],</span> d <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n <span style="color:#f92672">+</span> 1<span style="color:#f92672">][</span>m <span style="color:#f92672">+</span> 2<span style="color:#f92672">],</span> l <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n <span style="color:#f92672">+</span> 1<span style="color:#f92672">][</span>m <span style="color:#f92672">+</span> 2<span style="color:#f92672">],</span> r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>n <span style="color:#f92672">+</span> 1<span style="color:#f92672">][</span>m <span style="color:#f92672">+</span> 2<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> n<span style="color:#f92672">;</span> <span style="color:#f92672">++</span>i<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var j <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;=</span> m<span style="color:#f92672">;</span> <span style="color:#f92672">++</span>j<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>  <span style="color:#75715e">// 假设格子的列号从 1 开始，这样方便表示左右边界
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                u<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> c<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                d<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> c<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> c<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>                r<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> c<span style="color:#f92672">++;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        fa <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">[</span>c<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> c<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> fa<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> i<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        var ok <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">boolean</span><span style="color:#f92672">[</span>c<span style="color:#f92672">];</span> <span style="color:#75715e">// 能否容纳水
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 倒着判断每一行，寻找可能有水的区域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var i <span style="color:#f92672">=</span> n <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&gt;=</span> 0<span style="color:#f92672">;</span> <span style="color:#f92672">--</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var j <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;=</span> m<span style="color:#f92672">;</span> j<span style="color:#f92672">++)</span>
</span></span><span style="display:flex;"><span>                merge<span style="color:#f92672">(</span>r<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j <span style="color:#f92672">+</span> 1<span style="color:#f92672">]);</span> <span style="color:#75715e">// 连通左右
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var j <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;=</span> m<span style="color:#f92672">;</span> j<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                merge<span style="color:#f92672">(</span>d<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> u<span style="color:#f92672">[</span>i <span style="color:#f92672">+</span> 1<span style="color:#f92672">][</span>j<span style="color:#f92672">]);</span> <span style="color:#75715e">// 连通下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#75715e">// 根据格子的类型连接格子内部四个区域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                var type <span style="color:#f92672">=</span> shape<span style="color:#f92672">[</span>i<span style="color:#f92672">].</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>j <span style="color:#f92672">-</span> 1<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    merge<span style="color:#f92672">(</span>l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> u<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>                    merge<span style="color:#f92672">(</span>l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> d<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>                    merge<span style="color:#f92672">(</span>l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> r<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;l&#39;</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    merge<span style="color:#f92672">(</span>l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> d<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>                    merge<span style="color:#f92672">(</span>r<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> u<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                    merge<span style="color:#f92672">(</span>l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> u<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>                    merge<span style="color:#f92672">(</span>r<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> d<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var j <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;=</span> m<span style="color:#f92672">;</span> j<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// 在没有连接第 i-1 行的情况下，无法到达左右下边界 =&gt; 能容纳水
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                ok<span style="color:#f92672">[</span>l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]]</span> <span style="color:#f92672">=</span> find<span style="color:#f92672">(</span>l<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">])</span> <span style="color:#f92672">!=</span> find<span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                ok<span style="color:#f92672">[</span>r<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]]</span> <span style="color:#f92672">=</span> find<span style="color:#f92672">(</span>r<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">])</span> <span style="color:#f92672">!=</span> find<span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                ok<span style="color:#f92672">[</span>u<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]]</span> <span style="color:#f92672">=</span> find<span style="color:#f92672">(</span>u<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">])</span> <span style="color:#f92672">!=</span> find<span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>                ok<span style="color:#f92672">[</span>d<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">]]</span> <span style="color:#f92672">=</span> find<span style="color:#f92672">(</span>d<span style="color:#f92672">[</span>i<span style="color:#f92672">][</span>j<span style="color:#f92672">])</span> <span style="color:#f92672">!=</span> find<span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 第一行连上超级汇点，方便后面统一判断是否在闭合区域里面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var j <span style="color:#f92672">=</span> 1<span style="color:#f92672">;</span> j <span style="color:#f92672">&lt;=</span> m<span style="color:#f92672">;</span> j<span style="color:#f92672">++)</span>
</span></span><span style="display:flex;"><span>            merge<span style="color:#f92672">(</span>u<span style="color:#f92672">[</span>0<span style="color:#f92672">][</span>j<span style="color:#f92672">],</span> 0<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        var ans <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>var i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> c<span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ok<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> find<span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">==</span> find<span style="color:#f92672">(</span>0<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">++</span>ans<span style="color:#f92672">;</span> <span style="color:#75715e">// 能容纳水，且不在闭合区域里面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> ans <span style="color:#f92672">/</span> 2<span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">find</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> x<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>fa<span style="color:#f92672">[</span>x<span style="color:#f92672">]</span> <span style="color:#f92672">!=</span> x<span style="color:#f92672">)</span> fa<span style="color:#f92672">[</span>x<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> find<span style="color:#f92672">(</span>fa<span style="color:#f92672">[</span>x<span style="color:#f92672">]);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> fa<span style="color:#f92672">[</span>x<span style="color:#f92672">];</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">merge</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> x<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> y<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        fa<span style="color:#f92672">[</span>find<span style="color:#f92672">(</span>x<span style="color:#f92672">)]</span> <span style="color:#f92672">=</span> find<span style="color:#f92672">(</span>y<span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Solution</span> {
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> reservoir(vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&amp;</span>shape) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> n <span style="color:#f92672">=</span> shape.size(), m <span style="color:#f92672">=</span> shape[<span style="color:#ae81ff">0</span>].size(), c <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 每个格子分成四个区域（上下左右），标上序号，方便用并查集连通
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// 假设左右下还有一圈格子，直接连到超级汇点 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> u[n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][m <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>], d[n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][m <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>], l[n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][m <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>], r[n <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][m <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>        memset(u, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(u)); memset(d, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(d)); memset(l, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(l)); memset(r, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(r));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> n; <span style="color:#f92672">++</span>i)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;=</span> m; <span style="color:#f92672">++</span>j) <span style="color:#75715e">// 假设格子的列号从 1 开始，这样方便表示左右边界
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                u[i][j] <span style="color:#f92672">=</span> c<span style="color:#f92672">++</span>, d[i][j] <span style="color:#f92672">=</span> c<span style="color:#f92672">++</span>, l[i][j] <span style="color:#f92672">=</span> c<span style="color:#f92672">++</span>, r[i][j] <span style="color:#f92672">=</span> c<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 并查集模板
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> fa[c];
</span></span><span style="display:flex;"><span>        iota(fa, fa <span style="color:#f92672">+</span> c, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>        function<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span>(<span style="color:#66d9ef">int</span>)<span style="color:#f92672">&gt;</span> find <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> x) <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">int</span> { <span style="color:#66d9ef">return</span> fa[x] <span style="color:#f92672">==</span> x <span style="color:#f92672">?</span> x : fa[x] <span style="color:#f92672">=</span> find(fa[x]); };
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> merge <span style="color:#f92672">=</span> [<span style="color:#f92672">&amp;</span>](<span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) { fa[find(x)] <span style="color:#f92672">=</span> find(y); };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">bool</span> ok[c]; <span style="color:#75715e">// 能否容纳水
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        memset(ok, <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">sizeof</span>(ok));
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 倒着判断每一行，寻找可能有水的区域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> n <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; <span style="color:#f92672">--</span>i) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;=</span> m; j<span style="color:#f92672">++</span>) merge(r[i][j], l[i][j <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]); <span style="color:#75715e">// 连通左右
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;=</span> m; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                merge(d[i][j], u[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][j]); <span style="color:#75715e">// 连通下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#75715e">// 根据格子的类型连接格子内部四个区域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> (shape[i][j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;.&#39;</span>) merge(l[i][j], u[i][j]), merge(l[i][j], d[i][j]), merge(l[i][j], r[i][j]);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">if</span> (shape[i][j <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;l&#39;</span>) merge(l[i][j], d[i][j]), merge(r[i][j], u[i][j]);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span> <span style="color:#a6e22e">merge</span>(l[i][j], u[i][j]), merge(r[i][j], d[i][j]);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;=</span> m; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// 在没有连接第 i-1 行的情况下，无法到达左右下边界 =&gt; 能容纳水
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                ok[l[i][j]] <span style="color:#f92672">=</span> find(l[i][j]) <span style="color:#f92672">!=</span> find(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>                ok[r[i][j]] <span style="color:#f92672">=</span> find(r[i][j]) <span style="color:#f92672">!=</span> find(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>                ok[u[i][j]] <span style="color:#f92672">=</span> find(u[i][j]) <span style="color:#f92672">!=</span> find(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>                ok[d[i][j]] <span style="color:#f92672">=</span> find(d[i][j]) <span style="color:#f92672">!=</span> find(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// 第一行连上超级汇点，方便后面统一判断是否在闭合区域里面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;=</span> m; j<span style="color:#f92672">++</span>) merge(u[<span style="color:#ae81ff">0</span>][j], <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> c; i<span style="color:#f92672">++</span>)
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">+=</span> ok[i] <span style="color:#f92672">&amp;&amp;</span> find(i) <span style="color:#f92672">==</span> find(<span style="color:#ae81ff">0</span>); <span style="color:#75715e">// 能容纳水，且不在闭合区域里面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> ans <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>};
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">reservoir</span>(<span style="color:#a6e22e">shape</span> []<span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">n</span>, <span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">shape</span>), len(<span style="color:#a6e22e">shape</span>[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 每个格子分成四个区域（上下左右），标上序号，方便用并查集连通
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// 假设左右下还有一圈格子，直接连到超级汇点 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">u</span> <span style="color:#f92672">:=</span> make([][]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">n</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">d</span> <span style="color:#f92672">:=</span> make([][]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">n</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">l</span> <span style="color:#f92672">:=</span> make([][]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">n</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> make([][]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">n</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">u</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">u</span>[<span style="color:#a6e22e">i</span>] = make([]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">m</span><span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">i</span>] = make([]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">m</span><span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>] = make([]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">m</span><span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">i</span>] = make([]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">m</span><span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">n</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">m</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span> { <span style="color:#75715e">// 假设格子的列号从 1 开始，这样方便表示左右边界
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">u</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>] = <span style="color:#a6e22e">c</span>; <span style="color:#a6e22e">c</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>] = <span style="color:#a6e22e">c</span>; <span style="color:#a6e22e">c</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>] = <span style="color:#a6e22e">c</span>; <span style="color:#a6e22e">c</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>] = <span style="color:#a6e22e">c</span>; <span style="color:#a6e22e">c</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 并查集模板
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">fa</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">c</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">fa</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fa</span>[<span style="color:#a6e22e">i</span>] = <span style="color:#a6e22e">i</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">find</span> <span style="color:#66d9ef">func</span>(<span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">find</span> = <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">fa</span>[<span style="color:#a6e22e">x</span>] <span style="color:#f92672">!=</span> <span style="color:#a6e22e">x</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fa</span>[<span style="color:#a6e22e">x</span>] = <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">fa</span>[<span style="color:#a6e22e">x</span>])
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fa</span>[<span style="color:#a6e22e">x</span>]
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">merge</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">y</span> <span style="color:#66d9ef">int</span>) { <span style="color:#a6e22e">fa</span>[<span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">x</span>)] = <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">y</span>) }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">bool</span>, <span style="color:#a6e22e">c</span>) <span style="color:#75715e">// 能否容纳水
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// 倒着判断每一行，寻找可能有水的区域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">n</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">--</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">m</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]) <span style="color:#75715e">// 连通左右
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">m</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">u</span>[<span style="color:#a6e22e">i</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][<span style="color:#a6e22e">j</span>]) <span style="color:#75715e">// 连通下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#75715e">// 根据格子的类型连接格子内部四个区域
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">shape</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;.&#39;</span>:
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">u</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>])
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>])
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>])
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;l&#39;</span>:
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>])
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">u</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>])
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">u</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>])
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>], <span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>])
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">m</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">// 在没有连接第 i-1 行的情况下，无法到达左右下边界 =&gt; 能容纳水
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">ok</span>[<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>]] = <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">l</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>]) <span style="color:#f92672">!=</span> <span style="color:#a6e22e">find</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ok</span>[<span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>]] = <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">r</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>]) <span style="color:#f92672">!=</span> <span style="color:#a6e22e">find</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ok</span>[<span style="color:#a6e22e">u</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>]] = <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">u</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>]) <span style="color:#f92672">!=</span> <span style="color:#a6e22e">find</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">ok</span>[<span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>]] = <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">d</span>[<span style="color:#a6e22e">i</span>][<span style="color:#a6e22e">j</span>]) <span style="color:#f92672">!=</span> <span style="color:#a6e22e">find</span>(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 第一行连上超级汇点，方便后面统一判断是否在闭合区域里面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">1</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">m</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">merge</span>(<span style="color:#a6e22e">u</span>[<span style="color:#ae81ff">0</span>][<span style="color:#a6e22e">j</span>], <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ans</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">b</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">ok</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">i</span>) <span style="color:#f92672">==</span> <span style="color:#a6e22e">find</span>(<span style="color:#ae81ff">0</span>) { <span style="color:#75715e">// 能容纳水，且不在闭合区域里面
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#a6e22e">ans</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ans</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></article>

        </main><footer id="footer">
    
</footer>
</body>
</html>
